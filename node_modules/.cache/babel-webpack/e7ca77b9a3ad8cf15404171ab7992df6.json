{"ast":null,"code":"import { MatPaginator } from '@angular/material/paginator';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { DialogComponent } from 'src/app/shared/dialog/dialog.component';\nimport { MatTableDataSource } from '@angular/material/table';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/user.service\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"src/app/services/auth.service\";\nimport * as i4 from \"src/app/shared/snackbar/snackbar.component\";\nimport * as i5 from \"@angular/material/form-field\";\nimport * as i6 from \"@angular/material/input\";\nimport * as i7 from \"@angular/material/table\";\nimport * as i8 from \"@angular/material/paginator\";\nimport * as i9 from \"@angular/material/button\";\nimport * as i10 from \"@angular/material/icon\";\n\nfunction UsersListComponent_mat_header_cell_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-header-cell\");\n    i0.ɵɵtext(1, \" Nr. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction UsersListComponent_mat_cell_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-cell\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r11 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r11.id, \" \");\n  }\n}\n\nfunction UsersListComponent_mat_header_cell_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-header-cell\");\n    i0.ɵɵtext(1, \" Nume \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction UsersListComponent_mat_cell_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-cell\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r12 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r12.userName, \" \");\n  }\n}\n\nfunction UsersListComponent_mat_header_cell_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-header-cell\");\n    i0.ɵɵtext(1, \" Rol \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction UsersListComponent_mat_cell_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-cell\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r13 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r13.userRole, \" \");\n  }\n}\n\nfunction UsersListComponent_mat_header_cell_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-header-cell\");\n    i0.ɵɵtext(1, \" Stergeti \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction UsersListComponent_mat_cell_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"mat-cell\");\n    i0.ɵɵelementStart(1, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function UsersListComponent_mat_cell_23_Template_button_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const element_r14 = restoredCtx.$implicit;\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.onDeleteValidation(element_r14.userName, element_r14.userRole);\n    });\n    i0.ɵɵelementStart(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"delete_forever\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction UsersListComponent_mat_header_row_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-header-row\");\n  }\n}\n\nfunction UsersListComponent_mat_row_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-row\");\n  }\n}\n\nconst _c0 = function () {\n  return [7, 14, 21];\n};\n\nexport let UsersListComponent = /*#__PURE__*/(() => {\n  class UsersListComponent {\n    constructor(userService, dialog, authService, snackBar) {\n      this.userService = userService;\n      this.dialog = dialog;\n      this.authService = authService;\n      this.snackBar = snackBar;\n      this.displayedColumns = ['Id', 'Nume', 'Rol', 'Stergeti'];\n      this.destroy$ = new Subject();\n      this.user = {};\n      this.loggedInUser = {};\n      this.password = '';\n      this.confirmDeletion = false;\n    }\n\n    ngOnInit() {\n      this.loggedInUser = this.authService.sharedUserDetails$;\n\n      if (this.loggedInUser.password === null) {\n        this.openDialog();\n      } else {\n        this.onGetUserList();\n      }\n    }\n\n    openDialog() {\n      const dialogRef = this.dialog.open(DialogComponent, {\n        width: '320px',\n        data: {\n          userName: this.loggedInUser.userName,\n          password: this.password\n        }\n      });\n      dialogRef.afterClosed().pipe(takeUntil(this.destroy$)).subscribe(result => {\n        this.loggedInUser.password = result;\n        this.onGetUserList();\n      });\n    }\n\n    onGetUserList() {\n      this.userService.getUserList(this.loggedInUser.userName, this.loggedInUser.password).pipe(takeUntil(this.destroy$)).subscribe(result => {\n        if (result.length != 0) {\n          this.onFetchData(result);\n        } else {\n          this.snackBar.openSimpleMessageSnackbar(\"Parola gresita! reincercati\");\n          this.openDialog();\n        }\n      });\n    }\n\n    onFetchData(result) {\n      let count = 1;\n      this.usersList = result;\n      this.usersList.forEach(element => {\n        element.id = count++;\n      });\n      this.dataSource = new MatTableDataSource(this.usersList);\n      this.dataSource.paginator = this.paginator;\n    }\n\n    onDelete(username) {\n      this.userService.deleteUser(username, this.loggedInUser.userName, this.loggedInUser.password).pipe(takeUntil(this.destroy$)).subscribe(result => {\n        this.snackBar.openSimpleMessageSnackbar('The user ' + result);\n        this.onGetUserList();\n      });\n    }\n\n    onDeleteValidation(username, role) {\n      if (username == this.loggedInUser.userName) {\n        this.snackBar.openSimpleMessageSnackbar(\"Nu va puteti sterge propriul cont\");\n      } else if (role == 1) {\n        this.snackBar.openSimpleMessageSnackbar(\"Nu puteti sterge un administrator\");\n      } else {\n        this.openConfirmationDialog(username);\n      }\n    }\n\n    openConfirmationDialog(username) {\n      const dialogRef = this.dialog.open(DialogComponent, {\n        width: '320px',\n        data: {\n          userName: this.loggedInUser.userName,\n          confirm: this.confirmDeletion\n        }\n      });\n      dialogRef.afterClosed().pipe(takeUntil(this.destroy$)).subscribe(result => {\n        this.confirmDeletion = result;\n\n        if (this.confirmDeletion == true) {\n          this.onDelete(username);\n        } else {\n          this.snackBar.openSimpleMessageSnackbar(\"Operatiunea a fost anulata\");\n        }\n      });\n    }\n\n    applyFilter(event) {\n      const filterValue = event.target.value;\n      this.dataSource.filter = filterValue.trim().toLowerCase();\n\n      if (this.dataSource.paginator) {\n        this.dataSource.paginator.firstPage();\n      }\n    }\n\n  }\n\n  UsersListComponent.ɵfac = function UsersListComponent_Factory(t) {\n    return new (t || UsersListComponent)(i0.ɵɵdirectiveInject(i1.UserService), i0.ɵɵdirectiveInject(i2.MatDialog), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.SnackbarComponent));\n  };\n\n  UsersListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UsersListComponent,\n    selectors: [[\"app-users-list\"]],\n    viewQuery: function UsersListComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(MatPaginator, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.paginator = _t.first);\n      }\n    },\n    decls: 27,\n    vars: 5,\n    consts: [[1, \"users-list-container\"], [1, \"users-list-title\"], [1, \"role-details\"], [1, \"users-list-table\"], [\"appearance\", \"standard\"], [\"matInput\", \"\", \"placeholder\", \"Ex. Admin\", 3, \"keyup\"], [\"input\", \"\"], [1, \"mat-elevation-z8\", 3, \"dataSource\"], [\"matColumnDef\", \"Id\"], [4, \"matHeaderCellDef\"], [4, \"matCellDef\"], [\"matColumnDef\", \"Nume\"], [\"matColumnDef\", \"Rol\"], [\"matColumnDef\", \"Stergeti\"], [4, \"matHeaderRowDef\"], [4, \"matRowDef\", \"matRowDefColumns\"], [\"showFirstLastButtons\", \"\", 3, \"pageSizeOptions\"], [\"mat-button\", \"\", 3, \"click\"]],\n    template: function UsersListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"h1\", 1);\n        i0.ɵɵtext(2, \"Lista utilizatorilor\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"h3\", 2);\n        i0.ɵɵtext(4, \"(*Roluri: 1.Administrator, 2.Utlilizator)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 3);\n        i0.ɵɵelementStart(6, \"mat-form-field\", 4);\n        i0.ɵɵelementStart(7, \"mat-label\");\n        i0.ɵɵtext(8, \"Cautare\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"input\", 5, 6);\n        i0.ɵɵlistener(\"keyup\", function UsersListComponent_Template_input_keyup_9_listener($event) {\n          return ctx.applyFilter($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"mat-table\", 7);\n        i0.ɵɵelementContainerStart(12, 8);\n        i0.ɵɵtemplate(13, UsersListComponent_mat_header_cell_13_Template, 2, 0, \"mat-header-cell\", 9);\n        i0.ɵɵtemplate(14, UsersListComponent_mat_cell_14_Template, 2, 1, \"mat-cell\", 10);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementContainerStart(15, 11);\n        i0.ɵɵtemplate(16, UsersListComponent_mat_header_cell_16_Template, 2, 0, \"mat-header-cell\", 9);\n        i0.ɵɵtemplate(17, UsersListComponent_mat_cell_17_Template, 2, 1, \"mat-cell\", 10);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementContainerStart(18, 12);\n        i0.ɵɵtemplate(19, UsersListComponent_mat_header_cell_19_Template, 2, 0, \"mat-header-cell\", 9);\n        i0.ɵɵtemplate(20, UsersListComponent_mat_cell_20_Template, 2, 1, \"mat-cell\", 10);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementContainerStart(21, 13);\n        i0.ɵɵtemplate(22, UsersListComponent_mat_header_cell_22_Template, 2, 0, \"mat-header-cell\", 9);\n        i0.ɵɵtemplate(23, UsersListComponent_mat_cell_23_Template, 4, 0, \"mat-cell\", 10);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵtemplate(24, UsersListComponent_mat_header_row_24_Template, 1, 0, \"mat-header-row\", 14);\n        i0.ɵɵtemplate(25, UsersListComponent_mat_row_25_Template, 1, 0, \"mat-row\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(26, \"mat-paginator\", 16);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"dataSource\", ctx.dataSource);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"matHeaderRowDef\", ctx.displayedColumns);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"matRowDefColumns\", ctx.displayedColumns);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"pageSizeOptions\", i0.ɵɵpureFunction0(4, _c0));\n      }\n    },\n    directives: [i5.MatFormField, i5.MatLabel, i6.MatInput, i7.MatTable, i7.MatColumnDef, i7.MatHeaderCellDef, i7.MatCellDef, i7.MatHeaderRowDef, i7.MatRowDef, i8.MatPaginator, i7.MatHeaderCell, i7.MatCell, i9.MatButton, i10.MatIcon, i7.MatHeaderRow, i7.MatRow],\n    styles: [\".users-list-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.users-list-title[_ngcontent-%COMP%]{align-self:center;color:orange;margin-top:12px}.role-details[_ngcontent-%COMP%]{align-self:center;font-size:10}table[_ngcontent-%COMP%]{width:100%}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{width:25%}.mat-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%}\"]\n  });\n  return UsersListComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}