{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { DialogComponent } from '../../dialog/dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"src/app/services/auth.service\";\nimport * as i3 from \"../../snackbar/snackbar.component\";\nimport * as i4 from \"src/app/services/user.service\";\nimport * as i5 from \"@angular/material/form-field\";\nimport * as i6 from \"@angular/material/input\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"../../rating/rating.component\";\nimport * as i9 from \"@angular/material/button\";\nimport * as i10 from \"@angular/common\";\nimport * as i11 from \"@angular/material/divider\";\nimport * as i12 from \"@angular/material/icon\";\n\nfunction RecipeCommentsComponent_div_17_mat_icon_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\");\n    i0.ɵɵtext(1, \" star \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction RecipeCommentsComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵelementStart(1, \"p\");\n    i0.ɵɵelementStart(2, \"b\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4, \" \\u00A0 \");\n    i0.ɵɵelementStart(5, \"i\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8, \": \\u00A0\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\");\n    i0.ɵɵtemplate(10, RecipeCommentsComponent_div_17_mat_icon_10_Template, 2, 0, \"mat-icon\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"p\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(13, \"mat-divider\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const comm_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(comm_r1.userName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"(\", i0.ɵɵpipeBind2(7, 4, comm_r1.currentDate, \"medium\"), \")\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.stars(comm_r1.rating));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", comm_r1.message, \" \");\n  }\n}\n\nexport let RecipeCommentsComponent = /*#__PURE__*/(() => {\n  class RecipeCommentsComponent {\n    constructor(dialog, authService, snackBar, userService) {\n      this.dialog = dialog;\n      this.authService = authService;\n      this.snackBar = snackBar;\n      this.userService = userService;\n      this.rating = 1;\n      this.stars = Array;\n      this.loggedInUser = {};\n      this.confirmAction = false;\n      this.comment = {};\n      this.commentsArr = [];\n      this.msgFormCtrl = new FormControl();\n      this.recipeId = \"\";\n      this.destroy$ = new Subject();\n    }\n\n    ngOnInit() {\n      this.loggedInUser = this.authService.sharedUserDetails$;\n      this.getCommentsList();\n    }\n\n    onRatingUpdate(starRate) {\n      this.rating = starRate;\n    }\n\n    ngOnDestroy() {\n      this.destroy$.next(true);\n      this.destroy$.unsubscribe();\n    }\n\n    onCommentPost() {\n      this.initializeCommentObject();\n      const dialogRef = this.dialog.open(DialogComponent, {\n        width: '320px',\n        data: {\n          userName: this.loggedInUser.userName,\n          confirm: true\n        }\n      });\n      dialogRef.afterClosed().pipe(takeUntil(this.destroy$)).subscribe(result => {\n        this.confirmAction = result;\n\n        if (this.confirmAction == true) {\n          this.addComment();\n        } else {\n          this.snackBar.openSimpleMessageSnackbar(\"Operatiunea a fost anulata\");\n        }\n      });\n    }\n\n    addComment() {\n      this.userService.postComment(this.comment).pipe(takeUntil(this.destroy$)).subscribe(() => {\n        this.msgFormCtrl.reset();\n        this.rating = 1;\n        this.getCommentsList();\n        this.snackBar.openSimpleMessageSnackbar(\"Comentariul dvs. a fost adaugat\");\n      });\n    }\n\n    initializeCommentObject() {\n      this.comment.userName = this.loggedInUser.userName;\n      this.comment.currentDate = new Date();\n      this.comment.message = this.msgFormCtrl.value;\n      this.comment.rating = this.rating;\n      this.comment.recipesId = this.recipeId;\n    }\n\n    getCommentsList() {\n      this.userService.getComments(this.recipeId).pipe(takeUntil(this.destroy$)).subscribe(result => {\n        this.commentsArr = result;\n      });\n    }\n\n  }\n\n  RecipeCommentsComponent.ɵfac = function RecipeCommentsComponent_Factory(t) {\n    return new (t || RecipeCommentsComponent)(i0.ɵɵdirectiveInject(i1.MatDialog), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.SnackbarComponent), i0.ɵɵdirectiveInject(i4.UserService));\n  };\n\n  RecipeCommentsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: RecipeCommentsComponent,\n    selectors: [[\"app-recipe-comments\"]],\n    inputs: {\n      recipeId: \"recipeId\"\n    },\n    decls: 18,\n    vars: 3,\n    consts: [[1, \"comments-section\"], [1, \"form-section\"], [1, \"title-header\"], [\"appearance\", \"outline\", 1, \"comments-form-area\"], [\"matInput\", \"\", \"placeholder\", \"Lasati un mesaj\", 3, \"formControl\"], [1, \"form-posting-section\"], [3, \"rating\", \"ratingUpdated\"], [\"mat-button\", \"\", 1, \"add-comment-btn\", 3, \"click\"], [1, \"comments-list\"], [1, \"comments-title-header\"], [\"class\", \"comments-list-element\", 4, \"ngFor\", \"ngForOf\"], [1, \"comments-list-element\"], [4, \"ngFor\", \"ngForOf\"]],\n    template: function RecipeCommentsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"h1\", 2);\n        i0.ɵɵtext(3, \"Lasati un comentariu:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"mat-form-field\", 3);\n        i0.ɵɵelementStart(5, \"mat-label\");\n        i0.ɵɵtext(6, \"Parerea dumneavoastra conteaza...\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(7, \"textarea\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"div\", 5);\n        i0.ɵɵelementStart(9, \"p\");\n        i0.ɵɵtext(10, \"Dati o nota preparatului: \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"app-rating\", 6);\n        i0.ɵɵlistener(\"ratingUpdated\", function RecipeCommentsComponent_Template_app_rating_ratingUpdated_11_listener($event) {\n          return ctx.onRatingUpdate($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"button\", 7);\n        i0.ɵɵlistener(\"click\", function RecipeCommentsComponent_Template_button_click_12_listener() {\n          return ctx.onCommentPost();\n        });\n        i0.ɵɵtext(13, \"Adaugati\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"div\", 8);\n        i0.ɵɵelementStart(15, \"h1\", 9);\n        i0.ɵɵtext(16, \"Opiniile utilizatorilor:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(17, RecipeCommentsComponent_div_17_Template, 14, 7, \"div\", 10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"formControl\", ctx.msgFormCtrl);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"rating\", ctx.rating);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.commentsArr);\n      }\n    },\n    directives: [i5.MatFormField, i5.MatLabel, i6.MatInput, i7.DefaultValueAccessor, i7.NgControlStatus, i7.FormControlDirective, i8.RatingComponent, i9.MatButton, i10.NgForOf, i11.MatDivider, i12.MatIcon],\n    pipes: [i10.DatePipe],\n    styles: [\".comments-section[_ngcontent-%COMP%]{background-color:#fafafa;justify-content:space-around;border:1px groove #9c9c9c;margin-left:5px;margin-right:5px}.comments-section[_ngcontent-%COMP%], .form-section[_ngcontent-%COMP%]{display:flex;margin-top:10px;border-radius:5px;flex-direction:column}.form-section[_ngcontent-%COMP%]{background-color:#f8f6f2;margin-left:15px;margin-right:15px;border:1px groove #9c9c9c}.title-header[_ngcontent-%COMP%]{align-self:center;color:orange}.comments-form-area[_ngcontent-%COMP%]{margin-left:5px;margin-right:5px;padding:5px}.comments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:15px;margin-right:15px;margin-top:20px}.form-posting-section[_ngcontent-%COMP%]{align-self:center;margin-bottom:10px}.add-comment-btn[_ngcontent-%COMP%]{background-color:#fabf53;width:200px;margin-bottom:15px;align-self:center}textarea[_ngcontent-%COMP%]{height:130px}.comments-list-element[_ngcontent-%COMP%]{display:flex;flex-direction:column}.comments-title-header[_ngcontent-%COMP%]{color:orange;margin-left:20px}mat-icon[_ngcontent-%COMP%]{color:orange}\"]\n  });\n  return RecipeCommentsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}